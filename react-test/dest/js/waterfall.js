define(["require","exports","module","react","jquery"],function(e,t,n){var r=e("react"),i=e("jquery"),s=r.createClass({displayName:"Item",getInitialState:function(){return{height:0}},componentDidMount:function(){var e=i(this.refs.item.getDOMNode()),t=e.prev().prev();if(t.length===0)return;var n=t.position().top+t.height()+10;e.css({top:n});var r=e.parent(),s=e.height();n+=s,r.height()<n&&r.height(n),this.setState({height:e.find("img").get(0).height+"px"}),console.log(e.index())},render:function(){return r.createElement("div",{className:"waterfall-item",ref:"item"},r.createElement("img",{src:this.props.url}),r.createElement("p",null,this.state.height))}}),o=r.createClass({displayName:"List",render:function(){return r.createElement("div",{className:"waterfall-list"},this.props.urls.map(function(e){return r.createElement(s,{url:e})}))}}),u={urls:["img/01.jpg","img/02.jpg","img/03.jpg","img/04.jpg","img/05.jpg","img/06.jpg"],preload:function(e,t){var n=0,r=e.length,i=document.createElement("div");i.style.display="none",document.body.appendChild(i),e.forEach(function(e){var s=new Image;s.onload=function(){n+=1,n===r&&(document.body.removeChild(i),t())},s.src=e,i.appendChild(s)})},onScroll:function(){var e=[];e=e.concat(this.urls.concat(this.urls).sort(function(){return Math.random()-.5})),this.preload(e,function(){r.render(r.createElement(o,{urls:e}),document.getElementById("container")),window.addEventListener("scroll",function(){var t=i(window),n=t.scrollTop(),s=t.height(),u=i(document).height(),a=n+s-u;if(Math.abs(a)<=50){var f=this.urls.sort(function(){return Math.random()-.5});this.preload(f,function(){e=e.concat(f),r.render(r.createElement(o,{urls:e}),document.getElementById("container"))})}}.bind(this),!1)}.bind(this))},init:function(){this.onScroll()}};n.exports=u});